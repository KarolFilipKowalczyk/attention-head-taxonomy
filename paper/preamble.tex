%=============================================================================
% PREAMBLE.TEX - Packages, Macros, and Formatting
% See STYLE_GUIDE.md for writing conventions and style requirements
%=============================================================================

%-----------------------------------------------------------------------------
% Core Packages
%-----------------------------------------------------------------------------
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}

%-----------------------------------------------------------------------------
% Page Layout
%-----------------------------------------------------------------------------
\usepackage[margin=1in]{geometry}
\usepackage{setspace}
\onehalfspacing

%-----------------------------------------------------------------------------
% Mathematics
%-----------------------------------------------------------------------------
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}

%-----------------------------------------------------------------------------
% Tables and Figures
%-----------------------------------------------------------------------------
\usepackage{booktabs}
\usepackage{longtable}
\usepackage{array}
\usepackage{tabularx}
\usepackage{graphicx}
\usepackage{float}

%-----------------------------------------------------------------------------
% Colors and Styling
%-----------------------------------------------------------------------------
\usepackage{xcolor}
\definecolor{darkblue}{rgb}{0.0, 0.0, 0.5}
\definecolor{darkgreen}{rgb}{0.0, 0.5, 0.0}
\definecolor{darkred}{rgb}{0.5, 0.0, 0.0}

%-----------------------------------------------------------------------------
% Hyperlinks and References
%-----------------------------------------------------------------------------
\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=darkblue,
    citecolor=darkgreen,
    urlcolor=darkblue,
    bookmarksnumbered=true,
    pdfborder={0 0 0}
}
\usepackage{cleveref}

%-----------------------------------------------------------------------------
% Lists and Enumeration
%-----------------------------------------------------------------------------
\usepackage{enumitem}
\setlist{itemsep=0.1em, parsep=0.1em, topsep=0.3em}

%-----------------------------------------------------------------------------
% Boxes and Styling - Load tcolorbox package FIRST
%-----------------------------------------------------------------------------
\usepackage{tcolorbox}
\tcbuselibrary{skins,breakable}

%-----------------------------------------------------------------------------
% Section Formatting
%-----------------------------------------------------------------------------
\usepackage{titlesec}
\titlespacing*{\section}{0pt}{1.5em}{0.8em}
\titlespacing*{\subsection}{0pt}{1.0em}{0.5em}
\titlespacing*{\subsubsection}{0pt}{1em}{0.3em}

%-----------------------------------------------------------------------------
% Table of Contents
%-----------------------------------------------------------------------------
\setcounter{tocdepth}{3}  % Show sections, subsections, and subsubsections in TOC
\setcounter{secnumdepth}{3}  % Number up to subsubsections
\usepackage{tocloft}
\setlength{\cftbeforesecskip}{2pt}
\setlength{\cftbeforesubsecskip}{1pt}
\setlength{\cftbeforesubsubsecskip}{1pt}

%-----------------------------------------------------------------------------
% Bibliography
%-----------------------------------------------------------------------------
\usepackage{natbib}
\setcitestyle{square,numbers,comma}

%-----------------------------------------------------------------------------
% Paragraph Formatting
%-----------------------------------------------------------------------------
\setlength{\parindent}{0pt}
\setlength{\parskip}{0.5em}

%-----------------------------------------------------------------------------
% Typography Enhancements
%-----------------------------------------------------------------------------
% Improved microtypography (character protrusion only, expansion disabled for compatibility)
\usepackage[protrusion=true,expansion=false]{microtype}

% Better handling of quotes - use \enquote{} for proper quotes
\usepackage{csquotes}

% Intelligent spacing after commands
\usepackage{xspace}

%=============================================================================
% CUSTOM COMMANDS AND ENVIRONMENTS
%=============================================================================

%-----------------------------------------------------------------------------
% Depth Indicators
%-----------------------------------------------------------------------------
\newcommand{\Early}{\textsf{E}}
\newcommand{\Middle}{\textsf{M}}
\newcommand{\Late}{\textsf{L}}
\newcommand{\Final}{\textsf{F}}

%-----------------------------------------------------------------------------
% Head Entry Formatting
%-----------------------------------------------------------------------------
\newcommand{\depthinfo}[1]{\textbf{Depth:} \texttt{#1}}
\newcommand{\litnames}[1]{\textbf{Literature names:} \textit{#1}}
\newcommand{\statuswell}{\textsc{Well-documented}}
\newcommand{\statusobs}{\textsc{Observed}}
\newcommand{\statusprop}{\textsc{Proposed}}
\newcommand{\relatedheads}[1]{\textbf{Related:} #1}
\newcommand{\statusinfo}[1]{\textbf{Status:} #1}

% Compact footer: Status | Related
\newcommand{\headfooter}[2]{\noindent\statusinfo{#1} | \relatedheads{#2}}

%-----------------------------------------------------------------------------
% Attention Pattern Formatting
%-----------------------------------------------------------------------------
\newcommand{\attstrong}[1]{\textbf{Strong:} #1}
\newcommand{\attweak}[1]{\textbf{Weak:} #1}
\newcommand{\attreacts}[1]{\textbf{Reacts to:} #1}

%-----------------------------------------------------------------------------
% Example Scenario Formatting
%-----------------------------------------------------------------------------
\newcommand{\exinput}[1]{\textit{Input:} #1}
\newcommand{\exbehavior}[1]{\textit{Behavior:} #1}
\newcommand{\exeffect}[1]{\textit{Effect:} #1}

%-----------------------------------------------------------------------------
% Style Guide Compliance Helpers
%-----------------------------------------------------------------------------

% Proper abbreviations with automatic comma
\newcommand{\eg}{e.g.,\xspace}
\newcommand{\ie}{i.e.,\xspace}
\newcommand{\etc}{etc.\xspace}

% Non-breaking space before citations (use \citep or \citet with this)
\newcommand{\citenbsp}[1]{~\cite{#1}}

% Section symbol reference (Â§) - preferred style
\newcommand{\secref}[1]{Â§\ref{#1}}

% Depth reference in cross-references: head-name (D)
\newcommand{\headref}[2]{\hyperref[#1]{#2}}
\newcommand{\headrefwdepth}[3]{\hyperref[#1]{#2}~(#3)}

% Impact magnitude indicators for ablations
\newcommand{\impactcritical}[1]{#1\% degradation}
\newcommand{\impactsignificant}[1]{#1\% degradation}
\newcommand{\impactmoderate}[1]{#1\% degradation}
\newcommand{\impactreduced}[1]{#1\% degradation}

%-----------------------------------------------------------------------------
% Custom Environments
%-----------------------------------------------------------------------------
\newenvironment{functiondesc}{%
    \par\vspace{0.3em}%
    \noindent%
}{\par\vspace{0.3em}}

\newtcolorbox{attentionbox}{
    colback=gray!5,
    colframe=gray!40,
    boxrule=0.5pt,
    arc=2pt,
    left=3pt,
    right=3pt,
    top=2pt,
    bottom=2pt,
    boxsep=0pt,
    before skip=0.5em,
    after skip=0.5em
}

\newtcolorbox{examplebox}{
    colback=gray!8,
    colframe=gray!50,
    boxrule=0.5pt,
    arc=2pt,
    left=4pt,
    right=4pt,
    top=3pt,
    bottom=3pt,
    boxsep=0pt,
    before skip=0.5em,
    after skip=0.5em,
    fonttitle=\small\bfseries,
    title=Example Scenario
}

\newtcolorbox{ablationbox}{
    colback=white,
    colframe=gray!30,
    boxrule=0.5pt,
    arc=2pt,
    left=3pt,
    right=3pt,
    top=2pt,
    bottom=2pt,
    boxsep=0pt,
    before skip=0.5em,
    after skip=0.5em
}

%-----------------------------------------------------------------------------
% Quality Assurance Comments
%-----------------------------------------------------------------------------
% Use these during writing/review to flag items for attention
% Remove all before final compilation

\newcommand{\TODO}[1]{\textcolor{red}{\textbf{TODO:} #1}}
\newcommand{\FIXME}[1]{\textcolor{red}{\textbf{FIXME:} #1}}
\newcommand{\CHECKSTYLE}[1]{\textcolor{blue}{\textbf{STYLE:} #1}}

% To disable QA comments for final version, uncomment these:
% \renewcommand{\TODO}[1]{}
% \renewcommand{\FIXME}[1]{}
% \renewcommand{\CHECKSTYLE}[1]{}

%-----------------------------------------------------------------------------
% End of Preamble
%-----------------------------------------------------------------------------
