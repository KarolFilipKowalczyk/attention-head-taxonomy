%=============================================================================
\subsection{Memory \& Dependency Stack}
\label{sec:memory-stack}

\textbf{Stack overview:} Track references, resolve coreferences, and maintain dependency relationships. Enable understanding of which entities are discussed and how they relate.

%-----------------------------------------------------------------------------
\subsubsection{(E) Reference Resolution Heads}
\label{head:reference-resolution}

\noindent\depthinfo{0.08--0.25} | \litnames{reference head, pronoun head, anaphora head, mention head}

\begin{functiondesc}
Perform early-stage reference resolution for pronouns, definite descriptions, demonstratives, and possessives. Attend to potential referents matching in number, gender, and contextual appropriateness. Establish initial binding signals refined by later coreference heads. Operate on syntactic and positional cues rather than deep semantics.
\end{functiondesc}

\begin{attentionbox}
\attstrong{Pronouns to recent nouns, definite descriptions, demonstratives}\\
\attweak{Distant nouns, incompatible referents}\\
\attreacts{Pronouns, definite articles, possessives}
\end{attentionbox}

\begin{ablationbox}
\textbf{Expected ablation:} Degraded reference resolution, 20--30\% increase in errors. Later coreference heads partially compensate. Reduced handling of definite descriptions and complex referring patterns.
\end{ablationbox}

\begin{examplebox}
\exinput{``Alice met Bob. She smiled.''}\\
\exbehavior{``She'' attends to ``Alice'' (gender, recency)}\\
\exeffect{Establish initial bindings}
\end{examplebox}

\headfooter{\statuswell}{coreference (M), entity (M)}

%-----------------------------------------------------------------------------
\subsubsection{(M) Coreference Heads}
\label{head:coreference}

\noindent\depthinfo{0.35--0.60} | \litnames{coreference head, coref head}

\begin{functiondesc}
Determine when different expressions refer to the same entity. Integrate early reference signals with semantic understanding to resolve ambiguous cases. Handle split antecedents, bridging references, and discourse-level coreference. Critical for entity tracking across long contexts.
\end{functiondesc}

\begin{attentionbox}
\attstrong{Coreferential mentions regardless of form}\\
\attweak{Different entities, first mentions}\\
\attreacts{Semantic compatibility, discourse coherence}
\end{attentionbox}

\begin{ablationbox}
\textbf{Expected ablation:} Significant degradation in coreference resolution. Loss of entity tracking across complex reference chains. 30--40\% accuracy drop on question answering and summarization.
\end{ablationbox}

\begin{examplebox}
\exinput{``The CEO announced changes. The executive clarified. She...''}\\
\exbehavior{Link all three mentions to same entity}\\
\exeffect{Maintain consistent entity representation}
\end{examplebox}

\headfooter{\statuswell}{reference-resolution (E), entity (M), bridging (M)}

%-----------------------------------------------------------------------------
\subsubsection{(M) Long-Range Dependency Heads}
\label{head:long-range-dependency}

\noindent\depthinfo{0.40--0.65} | \litnames{long-range head, dependency head}

\begin{functiondesc}
Track syntactic and semantic dependencies across distant sequence positions (20--100+ tokens). Maintain connections between separated elements without degradation. Implement transformer advantage over RNNs: direct long-distance connections. Maintain multiple simultaneous long-range connections.
\end{functiondesc}

\begin{attentionbox}
\attstrong{Syntactically or semantically related distant tokens}\\
\attweak{Adjacent tokens, unrelated distant content}\\
\attreacts{Nested structures, long-distance agreement}
\end{attentionbox}

\begin{ablationbox}
\textbf{Expected ablation:} Degradation on complex sentences and long-range relationships. 25--35\% performance loss on long-distance reasoning. Severe impact on nested structures.
\end{ablationbox}

\begin{examplebox}
\exinput{``The book [that Alice mentioned [that Bob recommended]] was excellent.''}\\
\exbehavior{``was'' attends to ``book'' across nested clauses}\\
\exeffect{Maintain subject-verb agreement}
\end{examplebox}

\headfooter{\statusobs}{coreference (M), state-tracking (M)}

%-----------------------------------------------------------------------------
\subsubsection{(M) Bridging Heads}
\label{head:bridging}

\noindent\depthinfo{0.45--0.68} | \litnames{bridging head, associative reference head}

\begin{functiondesc}
Resolve bridging references requiring world knowledge inference. Connect mentions through implicit relationships: part-whole (``car'' $\rightarrow$ ``steering wheel''), role relations (``building'' $\rightarrow$ ``architect''), or causation. Require semantic knowledge about typical relationships.
\end{functiondesc}

\begin{attentionbox}
\attstrong{Associatively related entities (part-whole, role)}\\
\attweak{Unrelated entities, explicit coreference}\\
\attreacts{Implicit relationships, typical associations}
\end{attentionbox}

\begin{ablationbox}
\textbf{Expected ablation:} Loss of implicit reference resolution. Model becomes more literal, missing implicit relationships. 20--30\% degradation on inference-based connections.
\end{ablationbox}

\begin{examplebox}
\exinput{``We entered the house. The door was blue.''}\\
\exbehavior{``The door'' attends to ``house'' (part-whole)}\\
\exeffect{Understand: the house's door, not random door}
\end{examplebox}

\headfooter{\statusobs}{coreference (M), entity (M), fact (M)}

%-----------------------------------------------------------------------------
\subsubsection{(M) State-Tracking Heads}
\label{head:state-tracking}

\noindent\depthinfo{0.48--0.70} | \litnames{state-tracking head, tracking head, state head}

\begin{functiondesc}
Maintain and update changing state representations. Track entity property evolution: location changes, status updates, accumulating information. Maintain multiple simultaneous state representations for different entities. Integrate new information with existing states.
\end{functiondesc}

\begin{attentionbox}
\attstrong{State-changing events, current state, entity properties}\\
\attweak{Static descriptions, unchanging background}\\
\attreacts{Verbs of change, state transitions}
\end{attentionbox}

\begin{ablationbox}
\textbf{Expected ablation:} Difficulty tracking state changes. 25--35\% degradation on temporal reasoning. Narratives harder to follow when states evolve.
\end{ablationbox}

\begin{examplebox}
\exinput{``Alice was in NYC. She flew to Paris. She visited...''}\\
\exbehavior{Update Alice's location: NYC $\rightarrow$ Paris}\\
\exeffect{Contextualize ``visited'' in Paris}
\end{examplebox}

\headfooter{\statusobs}{coreference (M), long-range-dependency (M)}
